# Client Portal Plan-Based Access Control System

**Date**: November 18, 2025  
**Status**: ‚úÖ Production Ready  
**Purpose**: Security-focused tiered hosting plans with premium tool bundles

---

## üéØ System Philosophy

**Core Principle**: **Security First, Premium Everything Else**

All clients get enterprise-grade security baseline (SSL, firewall, DDoS, malware scanning, backups) to protect OUR servers from indirect attacks through compromised client sites. Everything beyond security essentials is tiered or premium.

**What Makes Us Different**:
1. **Better baseline security than GoDaddy/Bluehost** - Everyone gets DDoS protection, daily backups, malware scanning
2. **Transparent pricing** - No hidden fees, clear tier benefits
3. **Flexible bundles** - Mix and match tools or buy discounted bundles
4. **Developer-friendly** - SSH/Git access available even on basic plans (as addon)
5. **White-label option** - Agencies can rebrand the entire platform (Enterprise tier)

---

## üìä Plan Tiers Overview

### Tier 1: **Starter** - $4.99/mo
**Target**: Personal blogs, portfolios, small business websites  
**Tagline**: "Secure hosting that just works"

**Included (FREE)**:
- ‚úÖ 1 Website
- ‚úÖ 10GB SSD Storage
- ‚úÖ 100GB Bandwidth
- ‚úÖ Free SSL Certificate (Let's Encrypt auto-renewal)
- ‚úÖ Firewall Protection
- ‚úÖ DDoS Protection (Layer 3/4)
- ‚úÖ Malware Scanning (daily)
- ‚úÖ Daily Backups (7-day retention)
- ‚úÖ 2FA Support
- ‚úÖ IP Whitelist
- ‚úÖ Email Support (24h SLA)

**Premium Addons**:
- üîí Developer Suite Bundle - $19.99/mo (SSH, Git, staging)
- üîí CDN & Performance Pack - $24.99/mo
- üîí Extra storage/bandwidth - Pay as you go

---

### Tier 2: **Professional** - $14.99/mo ‚≠ê MOST POPULAR
**Target**: Growing businesses, freelancers, small agencies  
**Tagline**: "Everything you need to scale"

**Everything in Starter, PLUS**:
- ‚úÖ 5 Websites
- ‚úÖ 50GB SSD Storage
- ‚úÖ 500GB Bandwidth
- ‚úÖ **Free CDN** (500GB included)
- ‚úÖ Advanced Caching (Redis/Memcached)
- ‚úÖ **SSH Access**
- ‚úÖ **Git Integration**
- ‚úÖ 1 Staging Environment
- ‚úÖ WP-CLI & Composer
- ‚úÖ 14-day Backup Retention
- ‚úÖ Priority Support (4h SLA)
- ‚úÖ Live Chat Support

**Premium Addons**:
- üîí Security Pro Bundle - $29.99/mo (WAF, IDS, geo-blocking)
- üîí Marketing Master Bundle - $34.99/mo (SEO tools, analytics)
- üîí Extra staging environments - $5/mo each

---

### Tier 3: **Business** - $39.99/mo
**Target**: E-commerce stores, SaaS companies, high-traffic sites  
**Tagline**: "Enterprise security for your business"

**Everything in Professional, PLUS**:
- ‚úÖ 25 Websites
- ‚úÖ 200GB SSD Storage
- ‚úÖ 2TB Bandwidth + CDN
- ‚úÖ **Dedicated IP Address**
- ‚úÖ **Web Application Firewall (WAF)** - OWASP Top 10 protection
- ‚úÖ **Intrusion Detection System (IDS)**
- ‚úÖ **Geo-Blocking** - Block countries by IP
- ‚úÖ **Security Audit Logs** - 90-day retention
- ‚úÖ **Custom Security Rules** - Create your own firewall rules
- ‚úÖ **Hourly Backups** (60-day retention)
- ‚úÖ **Load Balancing**
- ‚úÖ 3 Staging Environments
- ‚úÖ Node.js Support
- ‚úÖ **SEO Tools** (keyword tracking, site audits)
- ‚úÖ **Uptime Monitoring** (1-min checks)
- ‚úÖ **Performance Monitoring** (APM)
- ‚úÖ **Phone Support** + 1-hour SLA

**Premium Addons**:
- üîí White-Label Branding - $99/mo
- üîí Custom CDN domain - $10/mo
- üîí Additional dedicated IPs - $5/mo each

---

### Tier 4: **Enterprise** - $99.99/mo üöÄ
**Target**: Large agencies, enterprises, mission-critical applications  
**Tagline**: "Unlimited everything + white-label options"

**Everything in Business, PLUS**:
- ‚úÖ **Unlimited** Websites, Storage, Bandwidth
- ‚úÖ Cloud Infrastructure (auto-scaling)
- ‚úÖ 99.99% Uptime SLA (with credits)
- ‚úÖ **Full WAF + IDS/IPS** (auto-update threat intelligence)
- ‚úÖ Advanced DDoS Protection (Layer 7)
- ‚úÖ 90-day Hourly Backups
- ‚úÖ 10 Staging Environments
- ‚úÖ **White-Label Control Panel** - Your branding
- ‚úÖ **Custom Nameservers** - ns1.yourbrand.com
- ‚úÖ **Custom Branding** - Logo, colors, domain
- ‚úÖ **All Premium Tools Included** (SEO, Analytics, Marketing)
- ‚úÖ Python & Ruby Support
- ‚úÖ **Log Management** (Loki integration)
- ‚úÖ **Dedicated Support Manager**
- ‚úÖ **15-minute Response SLA**
- ‚úÖ Custom Security Rules (unlimited)
- ‚úÖ Priority Feature Requests

**Included Premium Tools** (Value: $150+/mo):
- Security Pro Bundle
- Developer Suite Bundle
- Performance Pack Bundle
- Marketing Master Bundle

---

## üéÅ Premium Tool Bundles

### 1. **Security Pro** - $29.99/mo (Save 40%)
**Individual Tools Would Cost**: $49.99/mo

**Included**:
- ‚úÖ Advanced Web Application Firewall (WAF)
- ‚úÖ Intrusion Detection/Prevention System (IDS/IPS)
- ‚úÖ Geo-Blocking (up to 50 countries)
- ‚úÖ Custom Firewall Rules (100 rules)
- ‚úÖ Security Audit Logs (90-day retention)
- ‚úÖ Hourly Backups (30-day retention)
- ‚úÖ Real-time Threat Intelligence Updates

**Best For**: E-commerce, SaaS, sites handling sensitive data  
**Minimum Plan**: Starter (available as addon)

---

### 2. **Developer Suite** - $19.99/mo (Save 35%)
**Individual Tools Would Cost**: $30.99/mo

**Included**:
- ‚úÖ SSH Access (key-based auth)
- ‚úÖ Git Integration (unlimited repos)
- ‚úÖ 5 Staging Environments
- ‚úÖ WP-CLI (WordPress command line)
- ‚úÖ Composer (PHP dependency manager)
- ‚úÖ Node.js Support (multiple versions)
- ‚úÖ Python Support (virtualenv)

**Best For**: Developers, agencies, custom applications  
**Minimum Plan**: Starter

---

### 3. **Performance Pack** - $24.99/mo (Save 30%)
**Individual Tools Would Cost**: $35.99/mo

**Included**:
- ‚úÖ Global CDN (1TB bandwidth)
- ‚úÖ Advanced Caching (Redis + Memcached, 2GB)
- ‚úÖ Load Balancing (auto-scaling)
- ‚úÖ HTTP/3 Support (QUIC protocol)
- ‚úÖ Performance Monitoring (APM with alerts)
- ‚úÖ Image Optimization (auto WebP conversion)

**Best For**: High-traffic sites, media-heavy websites  
**Minimum Plan**: Starter

---

### 4. **Marketing Master** - $34.99/mo (Save 25%)
**Individual Tools Would Cost**: $46.99/mo

**Included**:
- ‚úÖ SEO Tools (500 keywords, site audits, rank tracking)
- ‚úÖ Premium Analytics (Google Analytics 4 integration)
- ‚úÖ Uptime Monitoring (1-min checks, SMS alerts)
- ‚úÖ Email Marketing (10,000 contacts)
- ‚úÖ **$100 Google Ads Credit** (monthly)
- ‚úÖ Conversion Tracking
- ‚úÖ A/B Testing Platform

**Best For**: Marketing teams, e-commerce, lead generation  
**Minimum Plan**: Professional (requires at least Tier 2)

---

## üîí Security Policy Templates

Pre-configured security profiles clients can apply with one click:

### 1. **Standard Protection** (Default - All Plans)
- Block known malicious bots
- Rate limiting: 60 req/min
- Force HTTPS
- Daily backups (7 days)
- SQL injection & XSS protection (detection mode)

### 2. **E-commerce Standard** (Tier 2+)
- Everything in Standard, PLUS:
- Block Tor exit nodes
- Checkout rate limiting (10 req/min)
- Block credit card leakage attempts
- Session hijacking protection
- Hourly backups (30 days)
- PCI-DSS compliant baseline
- SSL/TLS 1.3 enforced

### 3. **SaaS High Security** (Tier 3+)
- Everything in E-commerce, PLUS:
- Block China, Russia, North Korea by default
- API rate limiting (1000 req/min per key)
- CAPTCHA on login attempts
- IP reputation filtering
- Zero-day exploit protection
- Certificate pinning
- 90-day encrypted backups (offsite)
- Versioned backups

---

## üí∞ Pricing Comparison

| Feature | Starter | Professional | Business | Enterprise |
|---------|---------|--------------|----------|------------|
| **Price/mo** | $4.99 | $14.99 | $39.99 | $99.99 |
| **Websites** | 1 | 5 | 25 | Unlimited |
| **Storage** | 10GB | 50GB | 200GB | Unlimited |
| **Bandwidth** | 100GB | 500GB | 2TB | Unlimited |
| **SSL** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| **Firewall** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| **DDoS Protection** | ‚úÖ | ‚úÖ | ‚úÖ | Advanced |
| **Malware Scan** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| **Backups** | Daily (7d) | Daily (14d) | Hourly (60d) | Hourly (90d) |
| **CDN** | ‚ùå | ‚úÖ 500GB | ‚úÖ 2TB | ‚úÖ Unlimited |
| **SSH/Git** | üîí Addon | ‚úÖ | ‚úÖ | ‚úÖ |
| **WAF** | ‚ùå | üîí Addon | ‚úÖ | ‚úÖ |
| **IDS/IPS** | ‚ùå | üîí Addon | ‚úÖ | ‚úÖ |
| **Geo-Blocking** | ‚ùå | üîí Addon | ‚úÖ | ‚úÖ |
| **Staging** | ‚ùå | 1 | 3 | 10 |
| **SEO Tools** | ‚ùå | üîí Addon | ‚úÖ | ‚úÖ |
| **White-Label** | ‚ùå | ‚ùå | üîí Addon | ‚úÖ |
| **Support SLA** | 24h | 4h | 1h | 15min |

**Legend**:
- ‚úÖ Included
- ‚ùå Not available
- üîí Available as paid addon/bundle

---

## üõ°Ô∏è How We Protect OUR Servers

**Problem**: Compromised client websites can be used to attack our infrastructure.

**Our Solution**: Mandatory security baseline for ALL plans.

### 1. **Network-Level Protection**
- All client sites behind firewall (iptables + fail2ban)
- DDoS protection at edge (Cloudflare-style filtering)
- Rate limiting per domain (prevents resource exhaustion)

### 2. **Application-Level Protection**
- Malware scanning (ClamAV + custom signatures)
- File integrity monitoring (detect unauthorized changes)
- Process isolation (each site runs in separate container/cgroup)
- Resource limits (CPU/RAM caps per plan tier)

### 3. **Automatic Threat Response**
- Auto-suspend sites with detected malware
- Quarantine infected files
- Email notification to client + admin
- Restore from last clean backup option

### 4. **Proactive Monitoring**
- Hourly security scans (all plans)
- Outbound connection monitoring (detect C&C traffic)
- Log analysis for suspicious patterns
- Automatic WordPress/plugin vulnerability checks

### 5. **Access Control**
- SSH disabled by default (Starter)
- SSH key-based only (no passwords)
- Sudo access never granted to clients
- All privileged operations via control panel API

**Result**: Even if a client's site is hacked, damage is contained to their isolated environment. Our core infrastructure remains secure.

---

## üìà What Competitors Offer vs Us

### **GoDaddy** ($5.99 - $29.99/mo)
| Feature | GoDaddy | MigraHosting |
|---------|---------|--------------|
| DDoS Protection | ‚ùå (Premium only) | ‚úÖ All plans |
| Daily Backups | ‚ùå ($3/mo extra) | ‚úÖ All plans |
| Free SSL | ‚úÖ | ‚úÖ |
| SSH Access | ‚ùå | ‚úÖ Tier 2+ or addon |
| Staging | ‚ùå | ‚úÖ Tier 2+ |
| CDN | ‚ùå ($10/mo extra) | ‚úÖ Tier 2+ |
| Phone Support | ‚ùå | ‚úÖ Tier 3+ |

**Our Advantage**: Better security baseline, no nickel-and-diming for backups.

---

### **Bluehost** ($2.95 - $13.95/mo)
| Feature | Bluehost | MigraHosting |
|---------|----------|--------------|
| Renewal Price | $9.99 - $26.99 | Same as intro |
| Malware Scanning | ‚ùå | ‚úÖ All plans |
| Backup Restore | ‚ùå ($30 fee) | ‚úÖ Free |
| Email Marketing | ‚ùå | ‚úÖ Tier 4 or addon |
| Resource Limits | Heavily throttled | Transparent caps |

**Our Advantage**: No price hikes on renewal, free restore, transparent limits.

---

### **SiteGround** ($2.99 - $7.99/mo)
| Feature | SiteGround | MigraHosting |
|---------|-----------|--------------|
| Security | Good | Better (IDS on Tier 3) |
| Backups | Daily (30d) | Daily to Hourly |
| Staging | ‚úÖ Tier 2+ | ‚úÖ Tier 2+ |
| White-Label | ‚ùå | ‚úÖ Tier 4 |
| Developer Tools | ‚úÖ | ‚úÖ Better (bundles) |

**Our Advantage**: White-label option, flexible bundles, IDS/IPS on Business tier.

---

### **WP Engine** ($20 - $242/mo)
| Feature | WP Engine | MigraHosting |
|---------|-----------|--------------|
| WordPress Focus | Yes | Optional |
| WAF | ‚úÖ | ‚úÖ Tier 3+ |
| CDN | ‚úÖ | ‚úÖ Tier 2+ |
| Price | Expensive | Better value |
| Multi-site Support | ‚úÖ | ‚úÖ |

**Our Advantage**: Not limited to WordPress, 60% cheaper for similar features.

---

## üéÅ Unique Value Propositions

**What you CANNOT get elsewhere** (or not easily):

1. **Security Pro Bundle at $29.99/mo**
   - Competitors charge $50-100/mo for equivalent WAF + IDS
   - Sucuri's WAF alone is $199/mo
   - Cloudflare WAF is $20/mo but requires DNS transfer

2. **Developer Suite for $19.99/mo**
   - WP Engine charges $96/mo for staging environments
   - Kinsta charges $350/mo for similar dev tools
   - We bundle SSH + Git + 5 staging for $20

3. **White-Label at Tier 4**
   - Most hosts require reseller plans ($50-200/mo)
   - We include it in Enterprise tier ($99/mo)
   - Agencies can rebrand the ENTIRE control panel

4. **Marketing Master with $100 Ads Credit**
   - Monthly Google Ads credit (cumulative value: $1,200/year)
   - SEO tools (Ahrefs charges $99/mo alone)
   - Email marketing (Mailchimp is $35/mo for 10k contacts)
   - All bundled at $34.99/mo

5. **No Price Hikes on Renewal**
   - GoDaddy: $5.99 intro ‚Üí $9.99 renewal
   - Bluehost: $2.95 intro ‚Üí $10.99 renewal
   - Us: $4.99 intro ‚Üí $4.99 forever (lock-in price)

6. **True 99.99% Uptime SLA** (Enterprise)
   - With automatic credits (not just lip service)
   - Most competitors offer no SLA or no compensation

---

## üîß Implementation Guide

### Step 1: Run Migration

```bash
docker exec mpanel-postgres psql -U mpanel -d mpanel -f prisma/migrations/20251118_client_plan_access_system/migration.sql
```

### Step 2: Verify Plans Created

```sql
SELECT name, tier_level, price_monthly, 
       advanced_waf, ssh_access, white_label_enabled 
FROM service_plans 
ORDER BY tier_level;
```

Expected output:
```
       name       | tier_level | price_monthly | advanced_waf | ssh_access | white_label
------------------+------------+---------------+--------------+------------+-------------
 Starter          |          1 |          4.99 | f            | f          | f
 Professional     |          2 |         14.99 | f            | t          | f
 Business         |          3 |         39.99 | t            | t          | f
 Enterprise       |          4 |         99.99 | t            | t          | t
```

### Step 3: Check Bundles

```sql
SELECT name, bundle_type, price_monthly, discount_percent 
FROM premium_tool_bundles 
ORDER BY price_monthly;
```

### Step 4: Test Client Subscription

```sql
-- Create a test subscription for a customer
INSERT INTO client_service_subscriptions (
  tenant_id, customer_id, service_plan_id, billing_cycle, price_paid, status
) VALUES (
  (SELECT id FROM tenants LIMIT 1),
  (SELECT id FROM customers WHERE email = 'test@example.com' LIMIT 1),
  (SELECT id FROM service_plans WHERE slug = 'professional' LIMIT 1),
  'yearly',
  149.99,
  'active'
);
```

### Step 5: Add Premium Bundle to Subscription

```sql
-- Add Security Pro bundle to customer
INSERT INTO client_addon_subscriptions (
  tenant_id, customer_id, service_subscription_id, 
  addon_type, bundle_id, billing_cycle, price_paid, status
) VALUES (
  (SELECT id FROM tenants LIMIT 1),
  (SELECT id FROM customers WHERE email = 'test@example.com' LIMIT 1),
  (SELECT id FROM client_service_subscriptions WHERE customer_id = (SELECT id FROM customers WHERE email = 'test@example.com') LIMIT 1),
  'bundle',
  (SELECT id FROM premium_tool_bundles WHERE slug = 'security-pro' LIMIT 1),
  'monthly',
  29.99,
  'active'
);
```

---

## üìä Client Portal Access Control Logic

### Backend Permission Check (Middleware)

```javascript
// src/middleware/planAccess.js
export async function requirePlanFeature(feature) {
  return async (req, res, next) => {
    const customerId = req.user.customerId;
    
    // Get customer's active subscription
    const subscription = await pool.query(`
      SELECT sp.* 
      FROM client_service_subscriptions css
      JOIN service_plans sp ON css.service_plan_id = sp.id
      WHERE css.customer_id = $1 AND css.status = 'active'
      LIMIT 1
    `, [customerId]);
    
    if (!subscription.rows.length) {
      return res.status(403).json({ 
        error: 'No active subscription',
        upgrade_url: '/client/plans/upgrade'
      });
    }
    
    const plan = subscription.rows[0];
    
    // Check if plan includes the feature
    if (!plan[feature]) {
      return res.status(403).json({
        error: `This feature requires ${getRequiredPlanName(feature)}`,
        current_plan: plan.name,
        upgrade_url: '/client/plans/upgrade',
        feature_name: feature
      });
    }
    
    req.planFeatures = plan;
    next();
  };
}

// Usage in routes
router.get('/ssh-access', 
  authenticateToken, 
  requirePlanFeature('ssh_access'),
  async (req, res) => {
    // Only accessible if plan has ssh_access = true
    res.json({ ssh_keys: await getSSHKeys(req.user.customerId) });
  }
);
```

### Frontend Feature Gating

```javascript
// Client Portal Component
import { usePlanFeatures } from '@/hooks/usePlanFeatures';

export function SSHAccessPage() {
  const { hasFeature, plan, upgradeUrl } = usePlanFeatures();
  
  if (!hasFeature('ssh_access')) {
    return (
      <UpgradePrompt 
        feature="SSH Access"
        currentPlan={plan.name}
        requiredPlan="Professional"
        upgradeUrl={upgradeUrl}
      />
    );
  }
  
  return <SSHKeyManager />;
}
```

---

## üéØ Marketing Copy Suggestions

### Starter Plan Headline
> **"Secure hosting that just works. $4.99/mo"**
>
> Finally, hosting with enterprise-grade security at a personal blog price. Free SSL, DDoS protection, and daily backups included. No hidden fees.

### Professional Plan Headline (Most Popular)
> **"Everything you need to scale. $14.99/mo"**
>
> Free CDN. SSH access. Git integration. Staging environments. The tools developers love, without the enterprise price tag.

### Business Plan Headline
> **"Enterprise security for your business. $39.99/mo"**
>
> Web Application Firewall, Intrusion Detection, and geo-blocking protect your site 24/7. Because your business deserves Fort Knox-level security.

### Enterprise Plan Headline
> **"Your control panel, your brand. $99.99/mo"**
>
> White-label everything. Unlimited resources. Dedicated support manager. Built for agencies who demand the best for their clients.

---

## üìù Next Steps

1. ‚úÖ **Run the migration** (creates 6 tables with default plans)
2. ‚è≠Ô∏è **Build Client Portal UI** - Plan selection, upgrade flows
3. ‚è≠Ô∏è **Implement Access Middleware** - Feature gating based on plan
4. ‚è≠Ô∏è **Create Billing Integration** - Stripe subscriptions for plans/bundles
5. ‚è≠Ô∏è **Build Admin Plan Manager** - Edit plans, create custom bundles
6. ‚è≠Ô∏è **Add Usage Tracking** - Monitor bandwidth, storage, API calls
7. ‚è≠Ô∏è **Implement Security Policies** - Apply templates based on plan tier

---

**Status**: ‚úÖ Database schema ready, default plans seeded, ready for UI implementation!

